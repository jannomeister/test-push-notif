"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var component_event_service_1 = require("../services/component-event.service");
var moment = require("moment");
var momentTimezone = require("moment-timezone");
var CallSchedule = /** @class */ (function () {
    function CallSchedule() {
    }
    CallSchedule.prototype.deserialize = function (input) {
        Object.assign(this, input);
        return this;
    };
    CallSchedule.prototype.formatDate = function () {
        var date = new Date(this.callDate.replace(/-/g, "/"));
        return moment(date).format('ll');
    };
    CallSchedule.prototype.convertTo24hrs = function (time) {
        var hours = Number(time.match(/^(\d+)/)[1]);
        var minutes = Number(time.match(/:(\d+)/)[1]);
        var AMPM = time.match(/\s(.*)$/)[1];
        if ((AMPM == "PM" || AMPM == "pm") && hours < 12)
            hours = hours + 12;
        if ((AMPM == "AM" || AMPM == "am") && hours == 12)
            hours = hours - 12;
        var sHours = hours.toString();
        var sMinutes = minutes.toString();
        if (hours < 10)
            sHours = "0" + sHours;
        if (minutes < 10)
            sMinutes = "0" + sMinutes;
        return sHours + ":" + sMinutes + ":00";
    };
    CallSchedule.prototype.formatTime = function () {
        var timeArr = this.callTime.trim().split(':');
        var hours = parseInt(timeArr[0]);
        var minutes = parseInt(timeArr[1]);
        var ampm = hours >= 12 ? 'PM' : 'AM';
        hours = hours % 12;
        hours = hours ? hours : 12;
        minutes = minutes < 10 ? parseInt('0' + minutes) : minutes;
        var minutesStr = (minutes === 0) ? '00' : ((minutes < 10) ? '0' + minutes : minutes.toString());
        var strTime = hours + ':' + minutesStr + ' ' + ampm;
        return strTime;
    };
    CallSchedule.prototype.getSchedule = function () {
        if (!this.callDate || !this.callTime) {
            return 'No schedule yet.';
        }
        else {
            var d = new Date(this.callDate.trim()), month = d.getMonth() + 1, day = d.getDate(), year = d.getFullYear();
            var date = moment(year + "/" + month + "/" + day + " " + this.callTime, 'YYYY-MM-DD HH:mm:ss').format('lll');
            return date;
        }
    };
    CallSchedule.prototype.getStudentLocalTime = function (userTimezone, country) {
        var timezones = component_event_service_1.ComponentEventService.supportedTimezones;
        if (this.callDate && this.callTime) {
            country = country.toLowerCase();
            var studentTimezone = (country === 'guatemala') ? timezones[0] : ((country === 'zimbabwe') ? timezones[1] : timezones[0]);
            var date = this.callDate + " " + this.callTime;
            var userTime = momentTimezone.tz(date, 'YYYY-MM-DD HH:mm:ss', userTimezone);
            var studentTime = momentTimezone.tz(userTime, studentTimezone);
            var time_1 = studentTime.format('h:mm A');
            return "In " + country + " " + time_1;
        }
        else {
            return '';
        }
    };
    CallSchedule.prototype.getTime = function () {
        var dateAndTime = (this.callDate && this.callTime) ? new Date(this.callDate + " " + this.callTime) : new Date();
        var date = dateAndTime;
        return {
            hour: date.getHours(),
            minute: date.getMinutes()
        };
    };
    CallSchedule.prototype.getButtonText = function () {
        return (!this.skypeId && !this.callDate && !this.callTime) ? 'Ok' : ((this.skypeId && this.callDate && this.callTime) ? 'Ok' : 'Add');
    };
    CallSchedule.prototype.hasSchedule = function () {
        return (!this.skypeId && !this.callDate && !this.callTime) ? true : ((this.skypeId && this.callDate && this.callTime) ? true : false);
    };
    CallSchedule.prototype.hasDateAndTime = function () {
        return (this.callDate && this.callTime) ? true : false;
    };
    CallSchedule.prototype.isRequiredFieldsNotEmpty = function () {
        if (!this.skypeId ||
            !this.callDate ||
            !this.callTime) {
            return false;
        }
        else {
            return true;
        }
    };
    CallSchedule.prototype.isNotWeekend = function () {
        var date = new Date(this.callDate);
        var week = moment(date).weekday();
        return (week >= 1 && week <= 5) ? true : false;
    };
    CallSchedule.prototype.isCallConfirmed = function () {
        return (this.status === 'confirmed') ? true : false;
    };
    CallSchedule.prototype.isCallUnconfirmed = function () {
        return (this.status === 'unconfirmed') ? true : false;
    };
    return CallSchedule;
}());
exports.CallSchedule = CallSchedule;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FsbC1zY2hlZHVsZS5tb2RlbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImNhbGwtc2NoZWR1bGUubW9kZWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFDQSwrRUFBNEU7QUFFNUUsK0JBQWlDO0FBQ2pDLGdEQUFrRDtBQUVsRDtJQUFBO0lBc0pBLENBQUM7SUFySUEsa0NBQVcsR0FBWCxVQUFZLEtBQVU7UUFDbEIsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDM0IsT0FBTyxJQUFJLENBQUM7SUFDaEIsQ0FBQztJQUVELGlDQUFVLEdBQVY7UUFDQyxJQUFJLElBQUksR0FBRyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUV0RCxPQUFPLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDbEMsQ0FBQztJQUVFLHFDQUFjLEdBQWQsVUFBZSxJQUFJO1FBQ2YsSUFBSSxLQUFLLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUM1QyxJQUFJLE9BQU8sR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzlDLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFcEMsSUFBSSxDQUFDLElBQUksSUFBSSxJQUFJLElBQUksSUFBSSxJQUFJLElBQUksQ0FBQyxJQUFJLEtBQUssR0FBRyxFQUFFO1lBQUUsS0FBSyxHQUFHLEtBQUssR0FBRyxFQUFFLENBQUM7UUFDckUsSUFBSSxDQUFDLElBQUksSUFBSSxJQUFJLElBQUksSUFBSSxJQUFJ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O1FBRWxDLE9BQU8sQ0FBQyxJQUFJLElBQUksQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUM7SUFDbEQsQ0FBQztJQUVELHNDQUFlLEdBQWY7UUFDSSxPQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sS0FBSyxXQUFXLENBQUMsQ0FBQSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUM7SUFDdkQsQ0FBQztJQUVELHdDQUFpQixHQUFqQjtRQUNJLE9BQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxLQUFLLGFBQWEsQ0FBQyxDQUFBLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQztJQUN6RCxDQUFDO0lBQ0wsbUJBQUM7QUFBRCxDQUFDLEFBdEpELElBc0pDO0FBdEpZLG9DQUFZIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGVzZXJpYWxpemFibGUgfSBmcm9tIFwiLi9kZXNlcmlhbGl6YWJsZS5tb2RlbFwiO1xuaW1wb3J0IHsgQ29tcG9uZW50RXZlbnRTZXJ2aWNlIH0gZnJvbSBcIi4uL3NlcnZpY2VzL2NvbXBvbmVudC1ldmVudC5zZXJ2aWNlXCI7XG5cbmltcG9ydCAqIGFzIG1vbWVudCBmcm9tICdtb21lbnQnO1xuaW1wb3J0ICogYXMgbW9tZW50VGltZXpvbmUgZnJvbSAnbW9tZW50LXRpbWV6b25lJztcblxuZXhwb3J0IGNsYXNzIENhbGxTY2hlZHVsZSBpbXBsZW1lbnRzIERlc2VyaWFsaXphYmxlIHtcblxuXHRjYWxsU2NoZWR1bGVJZD86IG51bWJlcjtcblx0dXNlcklkPzogYW55O1xuXHRwcm9qZWN0SWQ/OiBhbnk7XG5cdHN0dWRlbnRJZD86IGFueTtcblx0ZXZlbnRJZD86IGFueTtcblx0c2t5cGVJZD86IHN0cmluZztcblx0Y2FsbERhdGU/OiBzdHJpbmc7XG5cdGNhbGxUaW1lPzogc3RyaW5nO1xuICAgIGxvY2FsVGltZT86IHN0cmluZztcblx0dGltZVpvbmU/OiBzdHJpbmc7XG5cdHJlbWluZGVyU3RhdHVzPzogbnVtYmVyO1xuXHRkYXRldGltZUNyZWF0ZWQ/OiBzdHJpbmc7XG5cdGRhdGV0aW1lVXBkYXRlZD86IHN0cmluZztcblx0c3RhdHVzPzogc3RyaW5nO1xuXG5cdGRlc2VyaWFsaXplKGlucHV0OiBhbnkpOiB0aGlzIHtcblx0ICAgIE9iamVjdC5hc3NpZ24odGhpcywgaW5wdXQpO1xuXHQgICAgcmV0dXJuIHRoaXM7XG5cdH1cblxuXHRmb3JtYXREYXRlKCkge1xuXHRcdGxldCBkYXRlID0gbmV3IERhdGUodGhpcy5jYWxsRGF0ZS5yZXBsYWNlKC8tL2csIFwiL1wiKSk7XG5cblx0XHRyZXR1cm4gbW9tZW50KGRhdGUpLmZvcm1hdCgnbGwnKTtcblx0fVxuXG4gICAgY29udmVydFRvMjRocnModGltZSkge1xuICAgICAgICBsZXQgaG91cnMgPSBOdW1iZXIodGltZS5tYXRjaCgvXihcXGQrKS8pWzFdKTtcbiAgICAgICAgbGV0IG1pbnV0ZXMgPSBOdW1iZXIodGltZS5tYXRjaCgvOihcXGQrKS8pWzFdKTtcbiAgICAgICAgbGV0IEFNUE0gPSB0aW1lLm1hdGNoKC9cXHMoLiopJC8pWzFdO1xuXG4gICAgICAgIGlmICgoQU1QTSA9PSBcIlBNXCIgfHwgQU1QTSA9PSBcInBtXCIpICYmIGhvdXJzIDwgMTIpIGhvdXJzID0gaG91cnMgKyAxMjtcbiAgICAgICAgaWYgKChBTVBNID09IFwiQU1cIiB8fCBBTVBNID09IFwiYW1cIikgJiYgaG91cnMgPT0gMTIpIGhvdXJzID0gaG91cnMgLSAxMjtcblxuICAgICAgICBsZXQgIHNIb3VycyA9IGhvdXJzLnRvU3RyaW5nKCk7XG4gICAgICAgIGxldCAgc01pbnV0ZXMgPSBtaW51dGVzLnRvU3RyaW5nKCk7XG5cbiAgICAgICAgaWYgKGhvdXJzIDwgMTApIHNIb3VycyA9IFwiMFwiICsgc0hvdXJzO1xuICAgICAgICBpZiAobWludXRlcyA8IDEwKSBzTWludXRlcyA9IFwiMFwiICsgc01pbnV0ZXM7XG5cbiAgICAgICAgcmV0dXJuIGAke3NIb3Vyc306JHtzTWludXRlc306MDBgO1xuICAgIH1cblxuXHRmb3JtYXRUaW1lKCkge1xuICAgICAgICBsZXQgdGltZUFyciA9IHRoaXMuY2FsbFRpbWUudHJpbSgpLnNwbGl0KCc6Jyk7XG5cbiAgICAgICAgbGV0IGhvdXJzID0gcGFyc2VJbnQodGltZUFyclswXSk7XG4gICAgICAgIGxldCBtaW51dGVzID0gcGFyc2VJbnQodGltZUFyclsxXSk7XG5cbiAgICAgICAgbGV0IGFtcG0gPSBob3VycyA+PSAxMiA/ICdQTScgOiAnQU0nO1xuXG4gICAgICAgIGhvdXJzID0gaG91cnMgJSAxMjtcbiAgICAgICAgaG91cnMgPSBob3VycyA/IGhvdXJzIDogMTI7XG5cbiAgICAgICAgbWludXRlcyA9IG1pbnV0ZXMgPCAxMCA/IHBhcnNlSW50KCcwJyttaW51dGVzKSA6IG1pbnV0ZXM7XG5cbiAgICAgICAgbGV0IG1pbnV0ZXNTdHIgPSAobWludXRlcyA9PT0gMCk/ICcwMCcgOiAoKG1pbnV0ZXMgPCAxMCk/ICcwJyttaW51dGVzIDogbWludXRlcy50b1N0cmluZygpKTtcbiAgICAgICAgXG4gICAgICAgIGxldCBzdHJUaW1lID0gaG91cnMgKyAnOicgKyBtaW51dGVzU3RyICsgJyAnICsgYW1wbTtcblxuICAgICAgICByZXR1cm4gc3RyVGltZTtcbiAgICB9XG5cbiAgICBnZXRTY2hlZHVsZSgpIHtcbiAgICAgICAgaWYoIXRoaXMuY2FsbERhdGUgfHwgIXRoaXMuY2FsbFRpbWUpIHtcbiAgICAgICAgICAgIHJldHVybiAnTm8gc2NoZWR1bGUgeWV0LidcbiAgICAgICAgfWVsc2Uge1xuICAgICAgICAgICAgbGV0IGQgPSBuZXcgRGF0ZSh0aGlzLmNhbGxEYXRlLnRyaW0oKSksXG4gICAgICAgICAgICAgICAgbW9udGggPSBkLmdldE1vbnRoKCkrMSxcbiAgICAgICAgICAgICAgICBkYXkgPSBkLmdldERhdGUoKSxcbiAgICAgICAgICAgICAgICB5ZWFyID0gZC5nZXRGdWxsWWVhcigpO1xuXG4gICAgICAgICAgICBsZXQgZGF0ZSA9IG1vbWVudChgJHt5ZWFyfS8ke21vbnRofS8ke2RheX0gJHt0aGlzLmNhbGxUaW1lfWAsICdZWVlZLU1NLUREIEhIOm1tOnNzJykuZm9ybWF0KCdsbGwnKTtcblxuICAgICAgICAgICAgcmV0dXJuIGRhdGU7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXRTdHVkZW50TG9jYWxUaW1lKHVzZXJUaW1lem9uZSwgY291bnRyeSkge1xuICAgIFx0bGV0IHRpbWV6b25lcyA9IENvbXBvbmVudEV2ZW50U2VydmljZS5zdXBwb3J0ZWRUaW1lem9uZXM7XG5cbiAgICBcdGlmKHRoaXMuY2FsbERhdGUgJiYgdGhpcy5jYWxsVGltZSkge1xuXG4gICAgXHRcdGNvdW50cnkgPSBjb3VudHJ5LnRvTG93ZXJDYXNlKCk7XG5cbiAgICBcdFx0bGV0IHN0dWRlbnRUaW1lem9uZSA9IChjb3VudHJ5ID09PSAnZ3VhdGVtYWxhJyk/IHRpbWV6b25lc1swXSA6ICgoY291bnRyeSA9PT0gJ3ppbWJhYndlJyk/IHRpbWV6b25lc1sxXSA6IHRpbWV6b25lc1swXSk7XG5cbiAgICBcdFx0bGV0IGRhdGUgPSBgJHt0aGlzLmNhbGxEYXRlfSAke3RoaXMuY2FsbFRpbWV9YDtcbiAgICBcdFx0bGV0IHVzZXJUaW1lID0gbW9tZW50VGltZXpvbmUudHooZGF0ZSwgJ1lZWVktTU0tREQgSEg6bW06c3MnLCB1c2VyVGltZXpvbmUpXG4gICAgICAgIFx0bGV0IHN0dWRlbnRUaW1lID0gbW9tZW50VGltZXpvbmUudHoodXNlclRpbWUsIHN0dWRlbnRUaW1lem9uZSk7XG5cbiAgICAgICAgXHRsZXQgdGltZSA9IHN0dWRlbnRUaW1lLmZvcm1hdCgnaDptbSBBJyk7XG4gICAgXHRcdFxuICAgIFx0XHRyZXR1cm4gYEluICR7Y291bnRyeX0gJHt0aW1lfWA7XG4gICAgXHR9ZWxzZSB7XG4gICAgXHRcdHJldHVybiAnJztcbiAgICBcdH1cbiAgICB9XG5cbiAgICBnZXRUaW1lKCkge1xuICAgICAgICBsZXQgZGF0ZUFuZFRpbWUgPSAodGhpcy5jYWxsRGF0ZSAmJiB0aGlzLmNhbGxUaW1lKT8gbmV3IERhdGUoYCR7dGhpcy5jYWxsRGF0ZX0gJHt0aGlzLmNhbGxUaW1lfWApIDogbmV3IERhdGUoKTtcbiAgICAgICAgbGV0IGRhdGUgPSBkYXRlQW5kVGltZTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgaG91cjogZGF0ZS5nZXRIb3VycygpLFxuICAgICAgICAgICAgbWludXRlOiBkYXRlLmdldE1pbnV0ZXMoKVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgZ2V0QnV0dG9uVGV4dCgpIHtcbiAgICAgICAgcmV0dXJuICghdGhpcy5za3lwZUlkICYmICF0aGlzLmNhbGxEYXRlICYmICF0aGlzLmNhbGxUaW1lKT8gJ09rJzooKHRoaXMuc2t5cGVJZCAmJiB0aGlzLmNhbGxEYXRlICYmIHRoaXMuY2FsbFRpbWUpPyAnT2snOiAnQWRkJyk7XG4gICAgfVxuXG4gICAgaGFzU2NoZWR1bGUoKSB7XG4gICAgICAgIHJldHVybiAoIXRoaXMuc2t5cGVJZCAmJiAhdGhpcy5jYWxsRGF0ZSAmJiAhdGhpcy5jYWxsVGltZSk/IHRydWUgOigodGhpcy5za3lwZUlkICYmIHRoaXMuY2FsbERhdGUgJiYgdGhpcy5jYWxsVGltZSk/IHRydWUgOiBmYWxzZSk7XG4gICAgfVxuXG4gICAgaGFzRGF0ZUFuZFRpbWUoKSB7XG4gICAgXHRyZXR1cm4gKHRoaXMuY2FsbERhdGUgJiYgdGhpcy5jYWxsVGltZSk/IHRydWUgOiBmYWxzZTtcbiAgICB9XG5cbiAgICBpc1JlcXVpcmVkRmllbGRzTm90RW1wdHkoKSB7XG4gICAgXHRpZihcbiAgICBcdFx0IXRoaXMuc2t5cGVJZCB8fFxuICAgIFx0XHQhdGhpcy5jYWxsRGF0ZSB8fFxuICAgIFx0XHQhdGhpcy5jYWxsVGltZVxuICAgIFx0KSB7XG4gICAgXHRcdHJldHVybiBmYWxzZTtcbiAgICBcdH1lbHNlIHtcbiAgICBcdFx0cmV0dXJuIHRydWU7XG4gICAgXHR9XG4gICAgfVxuXG4gICAgaXNOb3RXZWVrZW5kKCkge1xuICAgICAgICBsZXQgZGF0ZSA9IG5ldyBEYXRlKHRoaXMuY2FsbERhdGUpO1xuXG4gICAgICAgIGxldCB3ZWVrID0gbW9tZW50KGRhdGUpLndlZWtkYXkoKTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiAod2VlayA+PSAxICYmIHdlZWsgPD0gNSk/IHRydWUgOiBmYWxzZTtcbiAgICB9XG5cbiAgICBpc0NhbGxDb25maXJtZWQoKSB7XG4gICAgICAgIHJldHVybiAodGhpcy5zdGF0dXMgPT09ICdjb25maXJtZWQnKT8gdHJ1ZSA6IGZhbHNlO1xuICAgIH1cblxuICAgIGlzQ2FsbFVuY29uZmlybWVkKCkge1xuICAgICAgICByZXR1cm4gKHRoaXMuc3RhdHVzID09PSAndW5jb25maXJtZWQnKT8gdHJ1ZSA6IGZhbHNlO1xuICAgIH1cbn0iXX0=